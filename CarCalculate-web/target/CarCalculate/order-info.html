<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>订单信息管理</title>
    <link rel="stylesheet" href="css/other/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/navbar.css">
    <!-- <link rel="stylesheet" href="css/site.css"/> -->
    <!--<script src="js/ui-bootstrap-tpls.js"></script>-->
    <link rel="stylesheet" href="css/style.css"/>
    <link rel="stylesheet" href="css/sweet-alert.css"/>
    <script src="js/sweet-alert.min.js"></script>
    <link rel="stylesheet" href="css/angularjs-datetime-picker.css"/>
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <link href="css/bootstrap-datetimepicker.css" rel="stylesheet"/>


</head>
<body ng-app="ordeApp" ng-controller="orderController">
<div id="content">
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <div class="widget-box">
                    <div class="widget-content tab-content">
                        <!--用户信息管理-->
                        <div class="widget-box">
                            <div class="widget-title"><span class="icon"> <i class="icon-list"></i> </span>
                                <h5>订单信息管理</h5>
                            </div>
                            <div class="widget-content nopadding">
                                <form id="form-wizard" class="form-horizontal" name="orderForm">
                                    <div id="form-wizard-1" class="step">
                                        <div class="control-group control-group-inline">
                                            <label class="control-label">订单号：</label>

                                            <div class="controls">
                                                <input type="text" name="proposalNo" id="proposalNo"
                                                       ng-model="order.proposalNo" placeholder="订单号"/>
                                            </div>
                                        </div>
                                        <div class="control-group control-group-inline">
                                            <label class="control-label">投保人：</label>

                                            <div class="controls">
                                                <input type="text" name="appliName" id="appliName"
                                                       ng-model="order.appliName" placeholder="投保人"/>
                                            </div>
                                        </div>

                                        <div class="control-group control-group-inline">
                                            <label class="control-label">车牌号：</label>

                                            <div class="controls">
                                                <input type="text" name="licenseNo" id="licenseNo"
                                                       ng-model="order.licenseNo"/>
                                            </div>
                                        </div>
                                        <div class="control-group control-group-inline">
                                            <label class="control-label">车架号：</label>

                                            <div class="controls">
                                                <input type="text" name="frameNo" id="frameNo"
                                                       ng-model="order.frameNo"/>
                                            </div>
                                        </div>

                                        <div class="control-group control-group-inline">
                                            <label class="control-label"><span
                                                    class="require-tips">*</span>录入时间:</label>

                                            <div class="controls">


                                                <div class="input-append date">
                                                    <!-- <input ng-model="mainInfo.main.bzStartDate" class="datetimepicker"
                                                    datetime-picker date-format="yyyy-MM-dd" size="16"
                                                    date-only required/>  -->
                                                    <input class="w180" size="16" id="inputStartDate"
                                                           name="inputStartDate"
                                                           type="text" class="datetimepicker" orz
                                                           ng-model="order.inputStartDate" required/>
                                                    <span class="add-on"><i class="icon-calendar"></i></span>
                                                </div>

                                                <label class="help-inline"> - </label>

                                                <div class="input-append date"
                                                     data-date-format="yyyy-mm-dd">

                                                    <!-- <input ng-model="mainInfo.main.bzEndDate" class="datetimepicker"
                                                    datetime-picker date-format="yyyy-MM-dd" size="16"
                                                    date-only required/> -->
                                                    <input class="w180" size="16" id="inputEndDate" name="inputEndDate"
                                                           type="text" class="datetimepicker" orz
                                                           ng-model="order.inputEndDate" required/>
                                                    <span class="add-on"><i class="icon-calendar"></i></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="control-group">
                                            <div class="controls">
                                                <input class="btn btn-success span1" value="查 询"
                                                       type="button" ng-click="findOrder()">
                                                <!--<input id="userInfoDele" class="btn btn-success span1" value="重 置"-->
                                                <!--type="reset">-->
                                            </div>
                                        </div>
                                        <ul class="nav nav-list">
                                            <li class="divider"></li>
                                        </ul>
                                        <div class="form-horizontal">

                                            <table class="table table-bordered table-striped">
                                                <thead>
                                                <tr>
                                                    <th>订单号</th>
                                                    <th>投保人</th>
                                                    <th>车牌号</th>
                                                    <th>车架号</th>
                                                    <!--<th>发动机</th>-->
                                                    <th>归属业务员</th>
                                                    <th>录入时间</th>
                                                    <!--<th style="width:150px;">操作</th>-->
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr class="odd gradeX text-right"
                                                    ng-repeat="order in orderList.slice(((currentPage-1)*itemsPerPage), ((currentPage)*itemsPerPage))">
                                                    <!--<td class="controls">-->
                                                    <!--<input ng-model="order.proposalNo" ui-valid=""-->
                                                    <!--type="text">-->
                                                    <!--</td>-->
                                                    <td style="text-align: center;" ng-bind="order.proposalNo"></td>
                                                    <td style="text-align: center;" ng-bind="order.appliName"></td>
                                                    <td style="text-align: center;" ng-bind="order.licenseNo"></td>
                                                    <td style="text-align: center;" ng-bind="order.frameNo"></td>
                                                    <td style="text-align: center;" ng-bind="order.handlerName"></td>
                                                    <td style="text-align: center;" ng-bind="order.inputDate"></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                            <!--<tm-pagination conf="paginationConf"></tm-pagination>-->
                                            <div class="text-center">
                                                <pagination total-items="totalItems" ng-model="currentPage"
                                                            ng-change="pageChanged()" class="pagination-sm"
                                                            items-per-page="itemsPerPage"></pagination>

                                                </button>
                                            </div>
                                        </div>
                                        <!--<div id="userPaginator"></div>-->
                                        <!--<div  ></div>-->
                                    </div>
                                </form>
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="js/jquery.min.js"></script>
<!--<script src="js/ui-bootstrap-tpls-zh.js"></script>-->
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap-datetimepicker.js"></script>
<script src="js/bootstrap-datetimepicker.zh-CN.js"></script>

<script src="js/angular.min.js"></script>
<script src="js/ui-bootstrap-tpls-zh.js"></script>
<!--<script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.11.0.js"></script>-->
<script src="js/plugin/jquery.blockui.js"></script>
<script src="js/common/LoaderMask.js"></script>

<!--<script src="js/tm.pagination.js"></script>-->
<script>
    var ordeApp = angular.module("ordeApp", ['ui.bootstrap']);
    ordeApp.controller("orderController", function ($scope, $http) {

        //日期
        var d = new Date();
        var year = d.getFullYear();
        var month = d.getMonth() + 1;
        if (month < 10) {
            month = "0" + month;
        }
        ;
        var day = d.getDate();
        if (day < 10) {
            day = "0" + day;
        }
        var today = year + "-" + month + "-" + day;

        $scope.order = {
            "proposalNo": "",
            "appliName": "",
            "licenseNo": "",
            "frameNo": "",
            "handlerName": "",
            "inputStartDate": today,
            "inputEndDate": today
        };

//        设置翻页信息
        $scope.setPage = function (pageNo) {
            $scope.currentPage = pageNo;
        };

        $scope.pageChanged = function() {
            console.log('Page changed to: ' + $scope.currentPage);
        };

        $scope.setItemsPerPage = function(num) {
            $scope.itemsPerPage = num;
            $scope.currentPage = 1; //reset to first paghe
        }


        $scope.findOrder = function () {
//            校验订单信息
            if ($scope.order.proposalNo == '' && $scope.order.appliName == '' && $scope.order.licenseNo == '' && $scope.order.frameNo == '' && $scope.order.handlerName == '' && $scope.order.inputStartDate == '' && $scope.order.inputEndDate == '') {
                swal("系统提示:", "请至少输入一个查询条件", "warning");
                return;
            }
            var order = JSON.stringify($scope.order);
            $http.post("order/findOrders/013", order)
                    .success(function (data, status) {
                        $scope.viewby = 5;
                        $scope.totalItems = data.length;
                        $scope.currentPage = 1;
                        $scope.itemsPerPage = $scope.viewby;
                        $scope.maxSize = 5; //Number of pager buttons to show
                        $scope.orderList = data;

                    })
        }

    });
    ordeApp.directive('orz', function () {
        return {
            restrict: 'A',
            //总是和ng-model配合使用
            require: 'ngModel',
            scope: {
                //此方法需要与预先定义好，然后传递给视图控制器中的指令
                action: '&', //把我们所引用的select函数绑定到右边的作用域中
                dateflag: '='//双向绑定变量

            },
            link: function (scope, element, attrs, ngModel) {

                element.datetimepicker({
                    minView: "month",
                    format: "yyyy-mm-dd",
                    language: 'zh-CN',
                    autoclose: true,
                    clearBtn: true
                    //onSelect: function (dateText, inst) {
                    //    ngModel.$setViewValue(dateText);
                    //    scope.$apply();
                    //}
                })
                        .on('changeDate', function (e) {
                            //console.log('dp.change'+e.date.format('yyyy'));
                            $(this).datetimepicker('hide');
                            var year = e.date.getFullYear();
                            var month = e.date.getMonth() + 1;
                            if (month < 10) {
                                month = '0' + month;
                            }
                            var date = e.date.getDate();
                            if (date < 10) {
                                date = '0' + date;
                            }
                            var formatDate = year + '-' + month + '-' + date;
                            //console.log(formatDate);
                            //console.debug(scope);
                            ngModel.$setViewValue(formatDate);

                            scope.$apply();
                            scope.action();

                        });
            }
        }
    })


</script>
</body>
</html>
